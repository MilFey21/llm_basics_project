# Отчет Checkpoint №3: Финальная версия WindChaserSecurity

## Обзор проекта

**WindChaserSecurity** — это интерактивный образовательный тренажёр по безопасности систем искусственного интеллекта. Платформа предоставляет студентам практические занятия по изучению методов атак на LLM и RAG-системы, а также интеллектуальных AI-агентов для помощи и автоматической оценки.

### Ключевые компоненты системы

| Компонент | Технологии | Описание |
|-----------|------------|----------|
| **Frontend** | React 18 + TypeScript + Vite | Веб-интерфейс для студентов и преподавателей |
| **Backend** | FastAPI + Python 3.12 | REST API сервер с интеграцией AI-агентов |
| **Database** | PostgreSQL 16 | Хранение данных курсов, студентов, заданий |
| **Playground** | LangFlow | Low-code платформа для работы с AI |
| **Storage** | MinIO (S3) | Файловое хранилище для отчётов и логов |
| **Proxy** | nginx | Единая точка входа и балансировка |

---

## 1. Деплой

### Локальный деплой через Docker Compose

Проект полностью контейнеризирован и разворачивается одной командой. Docker Compose конфигурация включает 6 сервисов:

```yaml
services:
  nginx:           # Reverse proxy (порт 80)
  frontend:        # React приложение
  backend:         # FastAPI сервер
  langflow:         # LangFlow playground (порт 7860)
  postgres:        # База данных (порт 5432)
  minio:           # S3-хранилище (порты 9000, 9001)
```

### Инструкция по запуску

```bash
# 1. Клонирование репозитория
git clone https://github.com/AI-security-simulator/WindChaserSecurity
cd WindChaserSecurity

# 2. Создание конфигурации
cp .env.example .env
# важная переменная, которую надо указать самостоятельно:
# - OPENAI_API_KEY (для работы AI-агентов)

# 3. Запуск всех сервисов
docker compose --env-file .env up -d --build

# 4. Проверка статуса
docker compose ps
```

### Доступ к сервисам после запуска

| Сервис | URL | Описание |
|--------|-----|----------|
| **Frontend** | http://localhost/ | Веб-интерфейс тренажёра |
| **Backend API** | http://localhost/api/ | REST API эндпоинты |
| **API Docs** | http://localhost/api/docs | Swagger документация |
| **LangFlow** | http://localhost:7860/ | Playground для агентов студентов |

### Системные требования

- Docker и Docker Compose
- OpenAI API ключ (для работы AI-агентов)

---

## 2. Интерфейс

### Технологический стек Frontend

- **Framework**: React 18 + TypeScript
- **Build**: Vite
- **Routing**: React Router v6
- **State Management**: Zustand + TanStack Query
- **UI**: shadcn/ui + Tailwind CSS
- **Forms**: React Hook Form + Zod
- **Testing**: Vitest + React Testing Library + Playwright
- **API Mocking**: MSW (Mock Service Worker)

### Основные функции интерфейса

#### Для студентов:
1. **Каталог модулей** — просмотр доступных учебных модулей
2. **Плеер обучения** — выполнение уроков и практических заданий
3. **Ввод решений** — форма для отправки промптов атак
4. **Автоматическая оценка** — получение детальной обратной связи от AI-оценщика
5. **Чат с тьютором** — персонализированная помощь от AI-тьютора
6. **Отслеживание прогресса** — статистика выполнения заданий

#### Для администраторов:
1. Управление модулями и заданиями
2. Просмотр прогресса студентов

### Обработка ошибок

Интерфейс корректно обрабатывает ошибки:
- Валидация форм на клиенте (Zod)
- Информативные сообщения об ошибках API
- Graceful degradation при недоступности сервисов
- Fallback ответы от AI-агентов при ошибках

---

## 3. Демонстрация работы

![Каталог модулей](./figures/demo_1.jpeg)
*Рис. 1: Каталог модулей — студент выбирает модуль "Атаки на AI-компоненты"*

![Страница модуля](./figures/demo_2.jpeg)
*Рис. 2: Страница модуля со списком заданий и прогрессом*

![Плеер обучения](./figures/demo_3.jpeg)
*Рис. 3: Плеер обучения с навигацией по урокам и заданиям*

![Форма ввода](./figures/demo_4.jpeg)
*Рис. 4: Студент вводит промпт атаки и отправляет на проверку*

![Результат оценки](./figures/demo_5.jpeg)
*Рис. 5: EvaluatorAgent выдаёт детальную обратную связь с баллами по критериям*

![Чат с тьютором](./figures/demo_6.jpeg)
*Рис. 6: TutorAgent даёт персонализированные рекомендации по улучшению решения*

---

## 4. Архитектура AI-агентов

### EvaluatorAgent (Агент-оценщик)

Автоматически оценивает решения студентов по заданиям модуля "Атаки":

```
Запрос на оценку
    ↓
analyze_solution_stage (анализ этапа работы)
    ↓
Выбор валидатора на основе типа задания:
├── validate_system_prompt_extraction
├── validate_knowledge_base_secret_extraction
└── validate_token_limit_bypass
    ↓
LLM анализ техники атаки
    ↓
Формирование обратной связи "на ты"
    ↓
Взвешенные баллы по критериям
```

**Особенности**:
- Обязательная валидация: fallback, если агент не вызвал валидатор
- LLM анализ этапа работы: глубокий анализ вместо эвристик
- Множественные итерации: до 5 итераций для глубокого анализа
- Обратная связь "на ты": фокус на работе студента

### TutorAgent (Агент-тьютор)

Предоставляет персонализированную помощь студентам:

```
Вопрос студента
    ↓
analyze_student_stage (анализ этапа работы)
    ↓
Выбор стратегии помощи:
├── provide_theory_context (теория)
├── help_* (специализированная помощь)
└── ask_guiding_question (доспрашивание)
    ↓
Адаптация помощи
    ↓
Персонализированный ответ
```

**Особенности**:
- Адаптивная стратегия на основе этапа работы (initial, developing, reviewing)
- Уровни подсказок: subtle, moderate, direct
- Доспрашивание студентов через наводящие вопросы
- Комбинирование инструментов для полной помощи

---

## 5. Финальные метрики качества

### Метрики TutorAgent

| Метрика | Значение | Описание |
|---------|----------|----------|
| **Tool Selection Accuracy** | 76% | Точность выбора инструментов помощи |
| **Guiding Questions Usage** | 36% | Использование наводящих вопросов |
| **Всего тестовых случаев** | 100 | Вопросы студентов из `student_questions.csv` |

### Метрики EvaluatorAgent

| Метрика | Значение | Описание |
|---------|----------|----------|
| **Score Accuracy** | 48% | Точность попадания в диапазон баллов |
| **Validator Selection Accuracy** | 64% | Точность выбора валидатора |
| **LLM Analysis Usage** | 96% | Использование LLM для анализа |
| **Всего тестовых случаев** | 50 | Промпты атак из `attack_prompts.csv` |

### Анализ метрик

**TutorAgent**:
- Высокая точность выбора инструментов (76%) показывает корректную работу архитектуры
- Использование наводящих вопросов (36%) соответствует целевому диапазону 30-50% для этапа developing
- Агент успешно адаптирует стратегию помощи под конкретные ситуации

**EvaluatorAgent**:
- Высокое использование LLM анализа (96%) обеспечивает качественную оценку техник атак
- Score Accuracy (48%) может быть улучшена через:
  - Более точную калибровку весов критериев
  - Расширение контекста для валидаторов
  - Интеграцию с реальным системным промптом для точной проверки
- Валидаторы корректно выбираются в 64% случаев

---

## 6. Репозиторий

### Структура проекта

```
WindChaserSecurity/
├── backend/                    # FastAPI backend
│   ├── src/
│   │   ├── agents/            # AI-агенты
│   │   │   ├── evaluator/     # EvaluatorAgent
│   │   │   └── tutor/         # TutorAgent
│   │   ├── assistants/        # Профили ассистентов
│   │   ├── auth/              # Авторизация
│   │   ├── chat/              # Чат-сессии
│   │   ├── modules/           # Модули
│   │   ├── tasks/             # Задания
│   │   ├── progress/          # Прогресс студентов
│   │   └── main.py            # FastAPI приложение
│   ├── alembic/               # Миграции БД
│   ├── pyproject.toml         # Python зависимости (uv)
│   └── Dockerfile
├── frontend/                   # React frontend
│   ├── src/
│   │   ├── api/               # API клиент
│   │   ├── pages/             # Страницы
│   │   ├── features/          # Бизнес-логика
│   │   └── shared/            # UI компоненты
│   ├── package.json           # Node.js зависимости
│   └── Dockerfile
├── langflow/                    # LangFlow компоненты
│   ├── components/            # Кастомные узлы
│   └── RAG/                   # RAG индексация
├── nginx/                     # Reverse proxy
├── postgres/                  # Инициализация БД
├── docker-compose.yml         # Оркестрация
└── README.md                  # Документация
```

## 8. Заключение

### Что реализовано

✅ **Деплой**: Полная контейнеризация через Docker Compose (6 сервисов)

✅ **Интерфейс**: Современный веб-интерфейс на React + TypeScript с Tailwind CSS

✅ **AI-агенты**: EvaluatorAgent и TutorAgent на базе GPT-4o с function calling

✅ **Автоматическая оценка**: Детальная обратная связь с баллами по критериям

✅ **Персонализированная помощь**: Адаптивная стратегия тьютора под этап работы студента

✅ **Документация**: README, API docs, архитектура агентов, спецификации инструментов

### Планы по улучшению

1. **Интеграция Memory/Context**: Сохранение истории взаимодействий для лучшей адаптации
2. **Интеграция с LangFlow**: Использование реальных flows для валидации атак
3. **Улучшение Score Accuracy**: Калибровка весов и расширение контекста
4. **Rate-limiting LLM**: Ограничение запросов к API для безопасности

---
