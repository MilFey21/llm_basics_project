# ๐ช Kitesurfing RAG Index (Wikipedia)

ะะธะฝะธ-RAG ะธะฝะดะตะบั ะฝะฐ FAISS ะธะท ััััะบะพัะทััะฝะพะน Wikipedia ะฟะพ ัะตะผะต ะบะฐะนัััััะธะฝะณ.

## ะะพะทะผะพะถะฝะพััะธ

- **ะะฒะฐ ัะธะฟะฐ ะธะฝะดะตะบัะพะฒ:** PUBLIC (ะพะฑัะตะดะพัััะฟะฝะฐั ะธะฝัะพัะผะฐัะธั) ะธ PRIVATE (ะฟัะพัะตััะธะพะฝะฐะปัะฝะฐั/ะผะตัะพะดะธัะตัะบะฐั)
- ะกะฑะพั ะดะพะบัะผะตะฝัะพะฒ ะธะท Wikipedia ัะตัะตะท LangChain WikipediaRetriever
- ะะตะดัะฟะปะธะบะฐัะธั ะดะพะบัะผะตะฝัะพะฒ ะฟะพ ะบะพะฝัะตะฝัั
- ะงะฐะฝะบะธะฝะณ ั ะฟะพะผะพััั RecursiveCharacterTextSplitter
- ะะพัััะพะตะฝะธะต FAISS ะธะฝะดะตะบัะฐ ั sentence-transformers embeddings
- ะกะพััะฐะฝะตะฝะธะต/ะทะฐะณััะทะบะฐ ะธะฝะดะตะบัะฐ ะฝะฐ ะดะธัะบ
- ะะตะผะพ-ะฟะพะธัะบ ะฟะพ ะธะฝะดะตะบัั
- ะญะบัะฟะพัั ะธะฝะดะตะบัะฐ ะฒ JSON ัะพัะผะฐั
- ะะฝัะฟะตะบัะธั ัะพะดะตัะถะธะผะพะณะพ ะธะฝะดะตะบัะฐ

## ะขัะตะฑะพะฒะฐะฝะธั

- Python 3.10+
- ~500 MB ะดะธัะบะพะฒะพะณะพ ะฟัะพัััะฐะฝััะฒะฐ (ะดะปั ะผะพะดะตะปะธ sentence-transformers/all-MiniLM-L6-v2)
- ะะฝัะตัะฝะตั-ัะพะตะดะธะฝะตะฝะธะต (ะดะปั ะทะฐะณััะทะบะธ ััะฐัะตะน ะธะท Wikipedia)

## ะฃััะฐะฝะพะฒะบะฐ

### ะะฐัะธะฐะฝั 1: pip

```bash
pip install -r requirements.txt
```

### ะะฐัะธะฐะฝั 2: poetry

```bash
poetry install
```

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะกะพะทะดะฐะฝะธะต ะธะฝะดะตะบัะพะฒ ะธะท Wikipedia

#### ะกะพะทะดะฐัั ะพะฑะฐ ะธะฝะดะตะบัะฐ (PUBLIC ะธ PRIVATE)

```bash
python build_faiss_wiki.py --lang ru --index_dir ./faiss_kitesurf_wiki
```

ะญัะพ ัะพะทะดะฐัั:
- `./faiss_kitesurf_wiki/public/` - ะฟัะฑะปะธัะฝัะน ะธะฝะดะตะบั (36 seed-ะทะฐะฟัะพัะพะฒ)
- `./faiss_kitesurf_wiki/private/` - ะฟัะธะฒะฐัะฝัะน ะธะฝะดะตะบั (30 seed-ะทะฐะฟัะพัะพะฒ)

#### ะกะพะทะดะฐัั ัะพะปัะบะพ ะฟัะฑะปะธัะฝัะน ะธะฝะดะตะบั

```bash
python build_faiss_wiki.py --index_type public --index_dir ./faiss_kitesurf_wiki
```

#### ะกะพะทะดะฐัั ัะพะปัะบะพ ะฟัะธะฒะฐัะฝัะน ะธะฝะดะตะบั

```bash
python build_faiss_wiki.py --index_type private --index_dir ./faiss_kitesurf_wiki
```

#### ะัะต ะฟะฐัะฐะผะตััั

```bash
python build_faiss_wiki.py \
    --lang ru \
    --index_dir ./faiss_kitesurf_wiki \
    --index_type both \
    --top_k 1 \
    --chunk_size 1000 \
    --chunk_overlap 150 \
    --demo_k 5
```

### ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะพะฟัะธะธ

#### ะัะฟะพะปัะทะพะฒะฐะฝะธะต OpenAI embeddings (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะัะปะธ ั ะฒะฐั ะตััั OpenAI API ะบะปัั:

```bash
export OPENAI_API_KEY="sk-..."
python build_faiss_wiki.py --use_openai
```

โ๏ธ **ะะฐะถะฝะพ:** ะัะปะธ ะฒั ะธัะฟะพะปัะทัะตัะต OpenAI embeddings, ะฒัะตะณะดะฐ ะธัะฟะพะปัะทัะนัะต `--use_openai` ะดะปั ะทะฐะณััะทะบะธ ะธะฝะดะตะบัะฐ.

#### ะขะพะปัะบะพ ะดะตะผะพ-ะฟะพะธัะบ (ะฑะตะท ะฟะตัะตัะพะทะดะฐะฝะธั ะธะฝะดะตะบัะฐ)

```bash
python build_faiss_wiki.py --skip_build --index_dir ./faiss_kitesurf_wiki --index_type both
```

## ะะฐัะฐะผะตััั ะบะพะผะฐะฝะดะฝะพะน ัััะพะบะธ

### build_faiss_wiki.py

| ะะฐัะฐะผะตัั | ะะพ ัะผะพะปัะฐะฝะธั | ะะฟะธัะฐะฝะธะต |
|----------|--------------|----------|
| `--lang` | `ru` | ะฏะทัะบ Wikipedia (ัะพะปัะบะพ `ru`) |
| `--index_dir` | `./faiss_kitesurf_wiki` | ะะฐะทะพะฒะฐั ะฟะฐะฟะบะฐ ะดะปั ะธะฝะดะตะบัะพะฒ |
| `--index_type` | `both` | ะขะธะฟ ะธะฝะดะตะบัะฐ: `public`, `private`, ะธะปะธ `both` |
| `--top_k` | `1` | ะะพะปะธัะตััะฒะพ ัััะฐะฝะธั ะฝะฐ ะบะฐะถะดัะน seed-ะทะฐะฟัะพั |
| `--chunk_size` | `1000` | ะะฐะทะผะตั ัะฐะฝะบะฐ ะฒ ัะธะผะฒะพะปะฐั |
| `--chunk_overlap` | `150` | ะะตัะตะบัััะธะต ัะฐะฝะบะพะฒ ะฒ ัะธะผะฒะพะปะฐั |
| `--use_openai` | `false` | ะัะฟะพะปัะทะพะฒะฐัั OpenAI embeddings |
| `--skip_build` | `false` | ะัะพะฟัััะธัั ัะพะทะดะฐะฝะธะต ะธะฝะดะตะบัะฐ |
| `--demo_k` | `5` | ะะพะปะธัะตััะฒะพ ัะตะทัะปััะฐัะพะฒ ะฒ ะดะตะผะพ-ะฟะพะธัะบะต |

## ะัะธะผะตั ะฒัะฒะพะดะฐ

```
================================================================================
๐ช WIKIPEDIA KITESURFING RAG INDEX BUILDER (PUBLIC & PRIVATE)
================================================================================
  Language:      ru
  Base dir:      ./faiss_kitesurf_wiki
  Index type:    both
  Top K pages:   1
  Chunk size:    1000
  Chunk overlap: 150
================================================================================

2024-12-06 12:00:00 [INFO] Using HuggingFace embeddings: sentence-transformers/all-MiniLM-L6-v2

๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท
BUILDING PUBLIC INDEX
๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท

2024-12-06 12:00:01 [INFO] ========================================
2024-12-06 12:00:01 [INFO] STEP 1: Fetching Wikipedia documents for public index
2024-12-06 12:00:01 [INFO] ========================================
2024-12-06 12:00:01 [INFO] Fetching Wikipedia pages for: 'ะะฐะนัะฑะพัะดะธะฝะณ'
2024-12-06 12:00:02 [INFO]   โ Added: ะะฐะนัะฑะพัะดะธะฝะณ
...
2024-12-06 12:00:10 [INFO] Total unique documents fetched: 36

2024-12-06 12:00:10 [INFO] ========================================
2024-12-06 12:00:10 [INFO] STEP 2: Chunking documents for public index
2024-12-06 12:00:10 [INFO] ========================================
2024-12-06 12:00:10 [INFO] Total chunks created: 287

2024-12-06 12:00:10 [INFO] ========================================
2024-12-06 12:00:10 [INFO] STEP 3: Building FAISS index for public
2024-12-06 12:00:10 [INFO] ========================================
2024-12-06 12:00:15 [INFO] โ FAISS index saved to: ./faiss_kitesurf_wiki/public

๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท
BUILDING PRIVATE INDEX
๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท

2024-12-06 12:00:20 [INFO] ========================================
2024-12-06 12:00:20 [INFO] STEP 1: Fetching Wikipedia documents for private index
2024-12-06 12:00:20 [INFO] ========================================
2024-12-06 12:00:21 [INFO] Fetching Wikipedia pages for: 'ะกะฟะพััะธะฒะฝะฐั ััะตะฝะธัะพะฒะบะฐ'
...
2024-12-06 12:00:35 [INFO] Total unique documents fetched: 30

๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท
DEMO SEARCH
๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท๐ท

2024-12-06 12:00:40 [INFO] โ All done!
```

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
RAG/
โโโ build_faiss_wiki.py       # ะกะพะทะดะฐะฝะธะต PUBLIC ะธ PRIVATE ะธะฝะดะตะบัะพะฒ ะธะท Wikipedia
โโโ inspect_faiss_index.py    # ะะฝัะฟะตะบัะธั ะธะฝะดะตะบัะฐ (ะฟัะพัะผะพัั ะดะฐะฝะฝัั)
โโโ export_faiss_to_json.py   # ะญะบัะฟะพัั FAISS ะธะฝะดะตะบัะฐ ะฒ JSON
โโโ requirements.txt          # ะะฐะฒะธัะธะผะพััะธ pip
โโโ pyproject.toml            # ะะพะฝัะธะณ Poetry
โโโ README.md                 # ะะพะบัะผะตะฝัะฐัะธั
โโโ faiss_kitesurf_wiki/      # ะะฐะฟะบะฐ ั ะธะฝะดะตะบัะฐะผะธ (ัะพะทะดะฐะตััั)
    โโโ public/               # ะัะฑะปะธัะฝัะน ะธะฝะดะตะบั
    โ   โโโ index.faiss       # FAISS ะฒะตะบัะพัะฝัะน ะธะฝะดะตะบั
    โ   โโโ index.pkl         # ะะตัะฐะดะฐะฝะฝัะต ะดะพะบัะผะตะฝัะพะฒ
    โโโ private/              # ะัะธะฒะฐัะฝัะน ะธะฝะดะตะบั
        โโโ index.faiss       # FAISS ะฒะตะบัะพัะฝัะน ะธะฝะดะตะบั
        โโโ index.pkl         # ะะตัะฐะดะฐะฝะฝัะต ะดะพะบัะผะตะฝัะพะฒ
```

## ะััะพัะฝะธะบะธ ะดะฐะฝะฝัั

### PUBLIC ะธะฝะดะตะบั (36 seed-ะทะฐะฟัะพัะพะฒ)

Wikipedia ััะฐััะธ ะฟะพ ัะตะผะฐะผ:
- ะัะฝะพะฒั ะบะฐะนััะตััะธะฝะณะฐ ะธ ะพะฑะพััะดะพะฒะฐะฝะธะต
- ะะพะดะฝัะต ะธ ัะบัััะตะผะฐะปัะฝัะต ะฒะธะดั ัะฟะพััะฐ
- ะะตะทะพะฟะฐัะฝะพััั ะธ ะฟะตัะฒะฐั ะฟะพะผะพัั
- ะะพะฟัะปััะฝัะต ะบะฐะนั-ัะฟะพัั (ะผะพัั, ะพะบะตะฐะฝั)
- ะะตััะพะฒัะต ััะปะพะฒะธั ะธ ะฟะพะณะพะดะฐ (ะฟะฐััะฐั, ะผัััะพะฝั, ัะบะฒะฐะป)
- ะะธะดัะพะผะตัะตะพัะพะปะพะณะธั ะธ ะฟัะพะณะฝะพะท ะฟะพะณะพะดั
- ะะพะฑะตัะตะถัั ะธ ะฟะปัะถะธ

### PRIVATE ะธะฝะดะตะบั (30 seed-ะทะฐะฟัะพัะพะฒ)

Wikipedia ััะฐััะธ ะฟะพ ัะตะผะฐะผ:
- ะะตัะพะดะธะบะธ ะพะฑััะตะฝะธั ะธ ัะฟะพััะธะฒะฝะฐั ะฟะพะดะณะพัะพะฒะบะฐ
- ะขัะฐะฒะผะฐัะพะปะพะณะธั ะธ ัะฟะพััะธะฒะฝะฐั ะผะตะดะธัะธะฝะฐ
- ะคะธะทะธัะตัะบะฐั ะฟะพะดะณะพัะพะฒะบะฐ ะธ ะฑะธะพะผะตัะฐะฝะธะบะฐ
- ะัะธัะพะปะพะณะธั ัะฟะพััะฐ ะธ ะผะพัะธะฒะฐัะธั
- ะัะณะฐะฝะธะทะฐัะธั ัะฟะพััะธะฒะฝัั ัะพัะตะฒะฝะพะฒะฐะฝะธะน
- ะะธัะบ-ะผะตะฝะตะดะถะผะตะฝั ะธ ะฑะตะทะพะฟะฐัะฝะพััั ะถะธะทะฝะตะดะตััะตะปัะฝะพััะธ
- ะะตัะฒะฐั ะฟะพะผะพัั ะธ ัะฟะฐัะฐัะตะปัะฝัะต ัะฐะฑะพัั

## ะะฐะฑะพัะฐ ั ะณะพัะพะฒัะผะธ ะธะฝะดะตะบัะฐะผะธ

### ะัะพัะผะพัั ัะพะดะตัะถะธะผะพะณะพ ะธะฝะดะตะบัะฐ

```bash
# ะะพะบะฐะทะฐัั ััะฐัะธััะธะบั, ะผะตัะฐะดะฐะฝะฝัะต ะธ ะฟัะธะผะตัั ัะฐะฝะบะพะฒ
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public

# ะะพะบะฐะทะฐัั ะฟะพะปะฝะพะต ัะพะดะตัะถะธะผะพะต ะฟะตัะฒัั 3 ัะฐะฝะบะพะฒ
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public --show_full 3

# ะกะฟะธัะพะบ ะฒัะตั ะดะพะบัะผะตะฝัะพะฒ
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/private --list_all
```

### ะะพะธัะบ ะฟะพ ะธะฝะดะตะบัั

```bash
# ะัะพััะพะน ะฟะพะธัะบ
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public \
    --search "ะฒะตััะพะฒัะต ััะปะพะฒะธั" --search_k 5

# ะะพะธัะบ ั ะพัะตะฝะบะฐะผะธ ัะตะปะตะฒะฐะฝัะฝะพััะธ (similarity scores)
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public \
    --search "ะฑะตะทะพะฟะฐัะฝะพััั" --with_scores --search_k 3
```

### ะญะบัะฟะพัั ะฒ JSON

```bash
# ะะตัะพะด 1: ัะตัะตะท inspect_faiss_index.py
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public \
    --export_json ./chunks_public.json --show_chunks 0

# ะะตัะพะด 2: ัะตัะตะท export_faiss_to_json.py (ะฑััััะตะต)
python export_faiss_to_json.py --index_dir ./faiss_kitesurf_wiki/public \
    --output ./chunks_public.json

# ะญะบัะฟะพัั ะฒ stdout (ะดะปั pipe)
python export_faiss_to_json.py --index_dir ./faiss_kitesurf_wiki/public
```

## Troubleshooting

### ะัะธะฑะบะฐ "No module named 'langchain'" ะธะปะธ ะดััะณะธะต ะทะฐะฒะธัะธะผะพััะธ

```bash
pip install -r requirements.txt
```

ะะปะธ ัััะฐะฝะพะฒะธัะต ะพัะดะตะปัะฝัะต ะฟะฐะบะตัั:
```bash
pip install langchain langchain-community langchain-text-splitters langchain-huggingface faiss-cpu wikipedia sentence-transformers
```

### ะัะธะฑะบะฐ ะฟัะธ ะทะฐะณััะทะบะต ะธะท Wikipedia

- ะัะพะฒะตัััะต ะธะฝัะตัะฝะตั-ัะพะตะดะธะฝะตะฝะธะต
- Wikipedia ะผะพะถะตั ะฑััั ะฒัะตะผะตะฝะฝะพ ะฝะตะดะพัััะฟะฝะฐ ะธะปะธ rate-limited
- ะะพะฟัะพะฑัะนัะต ัะผะตะฝััะธัั `--top_k` ะดะพ 1

### ะะตะดะปะตะฝะฝะฐั ะทะฐะณััะทะบะฐ embeddings

ะัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต ะผะพะดะตะปั `sentence-transformers/all-MiniLM-L6-v2` ะทะฐะณััะถะฐะตััั (~90 MB).
ะะพัะปะตะดัััะธะต ะทะฐะฟััะบะธ ะธัะฟะพะปัะทััั ะบััะธัะพะฒะฐะฝะฝัั ะผะพะดะตะปั ะธะท `~/.cache/huggingface/`.

### ะะฐะถะฝะพ: ะกะพะฒะผะตััะธะผะพััั embedding ะผะพะดะตะปะตะน

โ๏ธ ะัะต ะธะฝะดะตะบัั ะดะพะปะถะฝั ะธัะฟะพะปัะทะพะฒะฐัั ะพะดะฝั ะธ ัั ะถะต embedding ะผะพะดะตะปั!  
- ะัะปะธ ัะพะทะดะฐะปะธ ะธะฝะดะตะบั ั HuggingFace embeddings (ะฟะพ ัะผะพะปัะฐะฝะธั), ะฒัะตะณะดะฐ ะธัะฟะพะปัะทัะนัะต ะธั
- ะัะปะธ ะธัะฟะพะปัะทะพะฒะฐะปะธ OpenAI (`--use_openai`), ะฒัะตะณะดะฐ ะดะพะฑะฐะฒะปัะนัะต ััะพั ัะปะฐะณ

## ะะธัะตะฝะทะธั

MIT

