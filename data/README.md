# ü™Å Kitesurfing RAG Index (Wikipedia)

–ú–∏–Ω–∏-RAG –∏–Ω–¥–µ–∫—Å –Ω–∞ FAISS –∏–∑ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π Wikipedia –ø–æ —Ç–µ–º–µ –∫–∞–π—Ç—Å—ë—Ä—Ñ–∏–Ω–≥.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–î–≤–∞ —Ç–∏–ø–∞ –∏–Ω–¥–µ–∫—Å–æ–≤:** PUBLIC (–æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è) –∏ PRIVATE (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è/–º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∞—è)
- –°–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ Wikipedia —á–µ—Ä–µ–∑ LangChain WikipediaRetriever
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –ß–∞–Ω–∫–∏–Ω–≥ —Å –ø–æ–º–æ—â—å—é RecursiveCharacterTextSplitter
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ FAISS –∏–Ω–¥–µ–∫—Å–∞ —Å sentence-transformers embeddings
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ –¥–∏—Å–∫
- –î–µ–º–æ-–ø–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É
- –≠–∫—Å–ø–æ—Ä—Ç –∏–Ω–¥–µ–∫—Å–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç
- –ò–Ω—Å–ø–µ–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- ~500 MB –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–¥–ª—è –º–æ–¥–µ–ª–∏ sentence-transformers/all-MiniLM-L6-v2)
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–µ–π –∏–∑ Wikipedia)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: pip

```bash
pip install -r requirements.txt
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: poetry

```bash
poetry install
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–∑ Wikipedia

#### –°–æ–∑–¥–∞—Ç—å –æ–±–∞ –∏–Ω–¥–µ–∫—Å–∞ (PUBLIC –∏ PRIVATE)

```bash
python build_faiss_wiki.py --lang ru --index_dir ./faiss_kitesurf_wiki
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- `./faiss_kitesurf_wiki/public/` - –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å (36 seed-–∑–∞–ø—Ä–æ—Å–æ–≤)
- `./faiss_kitesurf_wiki/private/` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å (30 seed-–∑–∞–ø—Ä–æ—Å–æ–≤)

#### –°–æ–∑–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å

```bash
python build_faiss_wiki.py --index_type public --index_dir ./faiss_kitesurf_wiki
```

#### –°–æ–∑–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å

```bash
python build_faiss_wiki.py --index_type private --index_dir ./faiss_kitesurf_wiki
```

#### –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```bash
python build_faiss_wiki.py \
    --lang ru \
    --index_dir ./faiss_kitesurf_wiki \
    --index_type both \
    --top_k 1 \
    --chunk_size 1000 \
    --chunk_overlap 150 \
    --demo_k 5
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI embeddings (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å OpenAI API –∫–ª—é—á:

```bash
export OPENAI_API_KEY="sk-..."
python build_faiss_wiki.py --use_openai
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ OpenAI embeddings, –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--use_openai` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–¥–µ–∫—Å–∞.

#### –¢–æ–ª—å–∫–æ –¥–µ–º–æ-–ø–æ–∏—Å–∫ (–±–µ–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞)

```bash
python build_faiss_wiki.py --skip_build --index_dir ./faiss_kitesurf_wiki --index_type both
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

### build_faiss_wiki.py

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--lang` | `ru` | –Ø–∑—ã–∫ Wikipedia (—Ç–æ–ª—å–∫–æ `ru`) |
| `--index_dir` | `./faiss_kitesurf_wiki` | –ë–∞–∑–æ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ |
| `--index_type` | `both` | –¢–∏–ø –∏–Ω–¥–µ–∫—Å–∞: `public`, `private`, –∏–ª–∏ `both` |
| `--top_k` | `1` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞ –∫–∞–∂–¥—ã–π seed-–∑–∞–ø—Ä–æ—Å |
| `--chunk_size` | `1000` | –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö |
| `--chunk_overlap` | `150` | –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤ –≤ —Å–∏–º–≤–æ–ª–∞—Ö |
| `--use_openai` | `false` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI embeddings |
| `--skip_build` | `false` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ |
| `--demo_k` | `5` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –¥–µ–º–æ-–ø–æ–∏—Å–∫–µ |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
data/
‚îú‚îÄ‚îÄ build_faiss_wiki.py       # –°–æ–∑–¥–∞–Ω–∏–µ PUBLIC –∏ PRIVATE –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–∑ Wikipedia
‚îú‚îÄ‚îÄ inspect_faiss_index.py    # –ò–Ω—Å–ø–µ–∫—Ü–∏—è –∏–Ω–¥–µ–∫—Å–∞ (–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö)
‚îú‚îÄ‚îÄ export_faiss_to_json.py   # –≠–∫—Å–ø–æ—Ä—Ç FAISS –∏–Ω–¥–µ–∫—Å–∞ –≤ JSON
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ pip
‚îú‚îÄ‚îÄ pyproject.toml            # –ö–æ–Ω—Ñ–∏–≥ Poetry
‚îú‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ faiss_kitesurf_wiki/      # –ü–∞–ø–∫–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è)
    ‚îú‚îÄ‚îÄ public/               # –ü—É–±–ª–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å
    ‚îÇ   ‚îú‚îÄ‚îÄ index.faiss       # FAISS –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å
    ‚îÇ   ‚îî‚îÄ‚îÄ index.pkl         # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ‚îî‚îÄ‚îÄ private/              # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å
        ‚îú‚îÄ‚îÄ index.faiss       # FAISS –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å
        ‚îî‚îÄ‚îÄ index.pkl         # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### PUBLIC –∏–Ω–¥–µ–∫—Å (36 seed-–∑–∞–ø—Ä–æ—Å–æ–≤)

Wikipedia —Å—Ç–∞—Ç—å–∏ –ø–æ —Ç–µ–º–∞–º:
- –û—Å–Ω–æ–≤—ã –∫–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥–∞ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
- –í–æ–¥–Ω—ã–µ –∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–µ—Ä–≤–∞—è –ø–æ–º–æ—â—å
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞–π—Ç-—Å–ø–æ—Ç—ã (–º–æ—Ä—è, –æ–∫–µ–∞–Ω—ã)
- –í–µ—Ç—Ä–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –∏ –ø–æ–≥–æ–¥–∞ (–ø–∞—Å—Å–∞—Ç, –º—É—Å—Å–æ–Ω—ã, —à–∫–≤–∞–ª)
- –ì–∏–¥—Ä–æ–º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—è –∏ –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã
- –ü–æ–±–µ—Ä–µ–∂—å—è –∏ –ø–ª—è–∂–∏

### PRIVATE –∏–Ω–¥–µ–∫—Å (30 seed-–∑–∞–ø—Ä–æ—Å–æ–≤)

Wikipedia —Å—Ç–∞—Ç—å–∏ –ø–æ —Ç–µ–º–∞–º:
- –ú–µ—Ç–æ–¥–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- –¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∏—è –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω–∞
- –§–∏–∑–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –±–∏–æ–º–µ—Ö–∞–Ω–∏–∫–∞
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Å–ø–æ—Ä—Ç–∞ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π
- –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–µ—Ä–≤–∞—è –ø–æ–º–æ—â—å –∏ —Å–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

## –†–∞–±–æ—Ç–∞ —Å –≥–æ—Ç–æ–≤—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–∏–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public

# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–≤—ã—Ö 3 —á–∞–Ω–∫–æ–≤
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public --show_full 3

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/private --list_all
```

### –ü–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É

```bash
# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public \
    --search "–≤–µ—Ç—Ä–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è" --search_k 5

# –ü–æ–∏—Å–∫ —Å –æ—Ü–µ–Ω–∫–∞–º–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (similarity scores)
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public \
    --search "–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" --with_scores --search_k 3
```

### –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON

```bash
# –ú–µ—Ç–æ–¥ 1: —á–µ—Ä–µ–∑ inspect_faiss_index.py
python inspect_faiss_index.py --index_dir ./faiss_kitesurf_wiki/public \
    --export_json ./chunks_public.json --show_chunks 0

# –ú–µ—Ç–æ–¥ 2: —á–µ—Ä–µ–∑ export_faiss_to_json.py (–±—ã—Å—Ç—Ä–µ–µ)
python export_faiss_to_json.py --index_dir ./faiss_kitesurf_wiki/public \
    --output ./chunks_public.json

# –≠–∫—Å–ø–æ—Ä—Ç –≤ stdout (–¥–ª—è pipe)
python export_faiss_to_json.py --index_dir ./faiss_kitesurf_wiki/public
```

## Troubleshooting

### –û—à–∏–±–∫–∞ "No module named 'langchain'" –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

–ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
```bash
pip install langchain langchain-community langchain-text-splitters langchain-huggingface faiss-cpu wikipedia sentence-transformers
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ Wikipedia

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- Wikipedia –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ rate-limited
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å `--top_k` –¥–æ 1

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ embeddings

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–¥–µ–ª—å `sentence-transformers/all-MiniLM-L6-v2` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (~90 MB).
–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å –∏–∑ `~/.cache/huggingface/`.

### –í–∞–∂–Ω–æ: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å embedding –º–æ–¥–µ–ª–µ–π

‚ö†Ô∏è –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ embedding –º–æ–¥–µ–ª—å!  
- –ï—Å–ª–∏ —Å–æ–∑–¥–∞–ª–∏ –∏–Ω–¥–µ–∫—Å —Å HuggingFace embeddings (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ OpenAI (`--use_openai`), –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —ç—Ç–æ—Ç —Ñ–ª–∞–≥


